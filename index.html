<!DOCTYPE HTML>
<html>
<head>
<link rel="stylesheet" href="style1.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
<script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>
<meta charset="UTF-8">
<title>Embedded Style Sheet</title>
<style>
 
</style>
</head>
<body>
  <div class="header">
    <img class="logo" src="static/thugraffes_logo.png" alt="Avatar" width="35" height="35">
    <h1 class="title">Scanooor</h1>
  </div>
  <div class="search_bar_container">
    <div id="search_bar_title"><h3>Search for your favorite Solana NFT</h3></div>
    <div id="search_bar_container_child">
      <label for="collection" id="collection_symbol_text"></label>
      <input type="text" id="collection" name="collection" placeholder="Search for a mint address">
      <button id="submit_button">
        <span><i class='fa-solid fa-magnifying-glass' style='color: white'></i></span>
      </button>
      <span><i id="loading_wheel"></i></span>
    </div>
  </div>
  <div id="output">
    <div class="nft_card" style="display:none">
        <img id="nft_img" />
        <div id="nft_card_data">
            <h3 id="nft_name" class="nft_card_data_item"></h3>
            <p id="nft_type" class="nft_card_data_item"></p>
            <p id="nft_collection" class="nft_card_data_item"></p>
            <p id="nft_protocol" class="nft_card_data_item"></p>
            <p id="nft_state" class="nft_card_data_item"></p>
            <p id="nft_delegate" class="nft_card_data_item"></p>
        </div>
    </div>
    <div class="nft_ata" style="display:none">
      <h3 id="nft_ata_title"class="nft_card_data_item"></h3>
      <p id="nft_ata_address"class="nft_card_data_item"></p>
      <p id="nft_ata_owner"class="nft_card_data_item"></p>
      <p id="nft_ata_delegate"class="nft_card_data_item"></p>
      <p id="nft_ata_delegated_amount"class="nft_card_data_item"></p>
  </div>
  </div>
  <div id="output_2">
    <div id="ant-tabs-container">
      <div class="ant-tabs-tab ant-tabs-active" id="metadata_account_ant_tab" style="display:none"><h3 class="ant-tabs-title">Metadata Account</h3></div>
      <div class="ant-tabs-tab" id="nft_mint_account_ant_tab" style="display:none"><h3 class="ant-tabs-title">Mint Account</h3></div>
      <div class="ant-tabs-tab" id="edition_account_ant_tab" style="display:none"><h3 class="ant-tabs-title">Edition Account</h3></div>
      <div class="ant-tabs-tab" id="off_chain_json_ant_tab" style="display:none"><h3 class="ant-tabs-title">Off-chain JSON</h3></div>
      <div class="ant-tabs-tab" id="transactions_ant_tab" style="display:none"><h3 class="ant-tabs-title">Transactions</h3></div>
      <div class="ant-tabs-tab optional_account" id="ruleset_account_ant_tab" style="display:none"><h3 class="ant-tabs-title">Ruleset Account</h3></div>
    </div>
    <div class="metadata_account active_account_card account_card" style="background-color:black">
        <h3 id="metadata_account_title"class="nft_card_data_item"></h3>
        <p id="metadata_account_address"class="nft_card_data_item"></p>
        <p id="metadata_account_update_authority"class="nft_card_data_item"></p>
        <p id="metadata_account_name"class="nft_card_data_item"></p>
        <p id="metadata_account_symbol"class="nft_card_data_item"></p> 
        <p id="metadata_account_uri"class="nft_card_data_item"></p> 
        <p id="metadata_account_seller_fee"class="nft_card_data_item"></p>
        <div id="metadata_account_creators"class="nft_card_data_item nft_card_data_item_creators">
            <p id="creators_title" class="creators_title"></p>
        </div>
        <p id="metadata_account_primary_sale_happened"class="nft_card_data_item"></p> 
        <p id="metadata_account_is_mutable"class="nft_card_data_item"></p> 
        <p id="metadata_account_edition_nonce"class="nft_card_data_item"></p> 
        <p id="metadata_account_token_standard"class="nft_card_data_item"></p> 
        <p id="metadata_account_collection"class="nft_card_data_item"></p> 
        <p id="metadata_account_uses"class="nft_card_data_item"></p> 
        <p id="metadata_account_collection_details"class="nft_card_data_item"></p> 
    </div>
    <div class="nft_mint_account account_card" style="display:none">
      <h3 id="nft_mint_account_title"class="nft_card_data_item"></h3>
      <p id="nft_mint_address"class="nft_card_data_item"></p>
      <p id="nft_mint_decimals"class="nft_card_data_item"></p>
      <p id="nft_mint_supply"class="nft_card_data_item"></p>
      <p id="nft_mint_update_authority"class="nft_card_data_item"></p>
      <p id="nft_mint_mint_authority"class="nft_card_data_item"></p>
      <p id="nft_mint_freeze_authority"class="nft_card_data_item"></p>
    </div>
    <div class="edition_account account_card" style="display:none">
        <h3 id="edition_account_title"class="nft_card_data_item"></h3>
        <p id="edition_account_address"class="nft_card_data_item"></p>
        <p id="edition_account_supply"class="nft_card_data_item"></p>
        <p id="edition_account_max_supply"class="nft_card_data_item"></p>
        <p id="edition_account_number"class="nft_card_data_item"></p> 
        <p id="edition_account_parent"class="nft_card_data_item"></p> 
    </div>
    <div class="off_chain_json account_card" style="display:none">
      <pre id="off_chain_json_pre_container">
      </pre>
    </div>
    <div class="transactions account_card" style="display:none">
      <table id="txns_table">
        <tr>
          <th>Signature</th>
          <th>Block</th>
          <th>Confirmation Status</th>
        </tr>
      </table>
    </div>
    <div class="ruleset_account optional_account account_card" style="display:none">
      <pre id="ruleset_account_pre_container">

      </pre>
    </div>
  </div>

  <footer class="footer">
    <div id="right-footer"><p>Built by <strong>Thugraffes.</strong> <a href="https://discord.gg/yWpWDdc976" target="_blank"><i class="fa-brands fa-discord" style="color:#5562EB"></i></a> | <a href="https://twitter.com/thugraffes" target="_blank"><i class="fa-brands fa-twitter" style="color:#1D96E8"></i></a></p></div>
  </footer>
</body>
<script type="text/javascript" src="testshit.js">

</script>

<script type="text/javascript">
  
const element = document.getElementById("submit_button");
element.addEventListener("click", callStart3);

const antTabs = [...document.getElementsByClassName("ant-tabs-tab")]
antTabs.forEach((antTab) => {
  antTab.addEventListener("click", onClickAntTab)
})

async function onClickAntTab(event) {
  let accountID = ""

  const activeTab = document.getElementsByClassName("ant-tabs-active")
  activeTab[0].classList.remove("ant-tabs-active")

  if(event.target.classList.contains("ant-tabs-title")) {
    event.target.parentElement.classList.add("ant-tabs-active")
    accountID = event.target.parentElement.id.split("_ant_tab")[0]

  } else if (event.target.classList.contains("ant-tabs-tab")) {
    event.target.classList.add("ant-tabs-active")
    accountID = event.target.id.split("_ant_tab")[0]

  }

  const currentActiveCard = document.getElementsByClassName("active_account_card")[0]
  currentActiveCard.style.display = "none"
  currentActiveCard.classList.remove("active_account_card")
  console.log(accountID)
  const accountToDisplay = document.getElementsByClassName(accountID)[0]
  console.log(accountToDisplay)
  accountToDisplay.style.display = "block"
  accountToDisplay.classList.add("active_account_card")
}


async function callStart3(mintAddress) {
  event.preventDefault()

  document.getElementById("output").style.display = "none"
  document.getElementById("output_2").style.display = "none"


  const accountCards = [...document.getElementsByClassName("account_card")]
  accountCards.forEach((accountCard) => {
    accountCard.classList.remove("active_account_card")
    accountCard.style.display = "none";
  })


  var element = document.getElementById("loading_wheel");
  element.className = "fa fa-spinner fa-spin";

  const optionalAccounts = [...document.getElementsByClassName("optional_account")]
  optionalAccounts.forEach((elem) => {
    elem.style.display = "none";
  })

  document.getElementsByClassName("ant-tabs-active")[0].classList.remove("ant-tabs-active")
  document.getElementById("metadata_account_ant_tab").classList.add("ant-tabs-active")

  const nftCardDataItems = [...document.getElementsByClassName("nft_card_data_item")]
  nftCardDataItems.forEach((item) => {
    if(![...item.classList].includes("nft_card_data_item_creators")) {
      item.innerText = " "
    }
  })

  const creatorAddresses = [...document.getElementsByClassName("creator_address")]
  creatorAddresses.forEach((item) => {
    item.innerText = " "
  })

  const creatorTitle = [...document.getElementsByClassName("creators_title")]
  creatorTitle.forEach((item) => {
    item.innerText = " "
  })

  var collection_symbol= document.getElementById("collection").value;

  var url = `http://localhost:5000/scanooor/${collection_symbol}`

  console.log(url)

  fetch(url).then(function (response) {

    return response.json()

  }).then(async (data) => {
    console.log(data)

    document.getElementById("output").removeAttribute("style")
    document.getElementById("output_2").removeAttribute("style")


    document.getElementsByClassName("nft_card")[0].removeAttribute("style")
    document.getElementsByClassName("nft_ata")[0].removeAttribute("style")
    document.getElementById("metadata_account_ant_tab").removeAttribute("style")
    document.getElementById("nft_mint_account_ant_tab").removeAttribute("style")
    document.getElementById("edition_account_ant_tab").removeAttribute("style")
    document.getElementById("off_chain_json_ant_tab").removeAttribute("style")
    document.getElementById("transactions_ant_tab").removeAttribute("style")

    document.getElementsByClassName("metadata_account")[0].removeAttribute("style")
    document.getElementsByClassName("metadata_account")[0].classList.add("active_account_card")

    document.getElementById("search_bar_title").style.display = "none";
    document.getElementById("search_bar_container_child").style = "justify-content: flex-start"
    document.getElementById("collection").style.width = "360px"

    var element = document.getElementById("loading_wheel");
    element.className = " ";

    // NFT card

    const nftImg = document.getElementById("nft_img")
    nftImg.setAttribute("src", data.json.image)
    nftImg.style.width = "200px"
    nftImg.style.height = "200px"

    const nftName = document.getElementById("nft_name")
    nftName.innerText = data.json.name

    const nftType = document.getElementById("nft_type")
    nftType.innerText = `Type: ${data.type.toUpperCase()}`

    const nftState = document.getElementById("nft_state")
    nftState.innerText = `State: ${data.ataState}`

    const nftProtocol = document.getElementById("nft_protocol")
    if(data.isOCP === true) {
      nftProtocol.innerText = "Protocol: OCP"
    } else if (data.isCardinal === true) {
      nftProtocol.innerText = "Protocol: Cardinal Labs"
    } else if (data.isMIP1 === true) {
      nftProtocol.innerText = "Protocol: MIP-1"
    } else {
      nftProtocol.innerText = "Protocol: Metaplex"
    }

    const nftCollection = document.getElementById("nft_collection")
    nftCollection.innerText = data.collection === null? "Collection: N/A" : `Collection: ${data.collection}`

    const nftDelegate = document.getElementById("nft_delegate")
    nftDelegate.innerText = data.ataDelegateAddress === null ? "Delegate: N/A" : `Delegate: ${data.ataDelegateAddress}`

    // Mint account

    const nftMintAccountTitle = document.getElementById("nft_mint_account_title")
    nftMintAccountTitle.innerText = "Mint Account"

    const nftMintAddress = document.getElementById("nft_mint_address")
    nftMintAddress.innerText = `Address: ${data.nft.address}`

    const nftMintDecimals = document.getElementById("nft_mint_decimals")
    nftMintDecimals.innerText = `Decimals: ${data.decimals}`

    const nftMintSupply = document.getElementById("nft_mint_supply")
    nftMintSupply.innerText = `Supply: ${parseInt(data.supply, 16)}`

    const nftMintAuthority = document.getElementById("nft_mint_mint_authority")
    nftMintAuthority.innerText = `Mint Authority: ${data.mintAuthority}`

    const nftFreezeAuthority = document.getElementById("nft_mint_freeze_authority")
    nftFreezeAuthority.innerText = `Freeze Authority: ${data.freezeAuthority}`

    // Associated Token Account 

    const nftAtaTitle = document.getElementById("nft_ata_title")
    nftAtaTitle.innerText = "Associated Token Account"

    const nftAtaAddress = document.getElementById("nft_ata_address")
    nftAtaAddress.innerText = `Address: ${data.ataAddress}`

    const nftAtaDelegate = document.getElementById("nft_ata_delegate")
    nftAtaDelegate.innerText = `Delegate: ${data.ataDelegateAddress}`

    const nftAtaDelegatedAmount = document.getElementById("nft_ata_delegated_amount")
    nftAtaDelegatedAmount.innerText = `Delegated Amount: ${data.ataDelegatedAmount}`

    const nftAtaOwner = document.getElementById("nft_ata_owner")
    nftAtaOwner.innerText = `Owner: ${data.ataOwnerAddress}`

    // Edition Account

    if(data.nft.edition != null) {
        if(data.nft.edition.isOriginal === true) {
            const editionAccountNumber = document.getElementById("edition_account_number")
            editionAccountNumber.innerText = " "

            const editionAccountParent = document.getElementById("edition_account_parent")
            editionAccountParent.innerText = " "
            
            const editionAccountTitle = document.getElementById("edition_account_title")
            editionAccountTitle.innerText = data.nft.edition.isOriginal === false ? "Edition Account" : "Master Edition Account"

            const editionAccountAddress = document.getElementById("edition_account_address")
            editionAccountAddress.innerText = `Address: ${data.nft.edition.address}`

            const editionAccountSupply = document.getElementById("edition_account_supply")
            editionAccountSupply.innerText = `Supply: ${parseInt(data.nft.edition.supply, 16)}`

            const editionAccountMaxSupply = document.getElementById("edition_account_max_supply")
            editionAccountMaxSupply.innerText = `Max Supply: ${parseInt(data.nft.edition.maxSupply, 16)}`
        } else {
            const editionAccountSupply = document.getElementById("edition_account_supply")
            editionAccountSupply.innerText = " "

            const editionAccountMaxSupply = document.getElementById("edition_account_max_supply")
            editionAccountMaxSupply.innerText = " "

            const editionAccountTitle = document.getElementById("edition_account_title")
            editionAccountTitle.innerText = data.nft.edition.isOriginal === false ? "Edition Account" : "Master Edition Account"

            const editionAccountAddress = document.getElementById("edition_account_address")
            editionAccountAddress.innerText = `Address: ${data.nft.edition.address}`

            const editionAccountNumber = document.getElementById("edition_account_number")
            editionAccountNumber.innerText = `Number: ${parseInt(data.nft.edition.number, 16)}`

            const editionAccountParent = document.getElementById("edition_account_parent")
            editionAccountParent.innerText = `Parent: ${data.nft.edition.parent}`
        }
    }

    // Metadata Account

    const metadataAccountTitle = document.getElementById("metadata_account_title")
    metadataAccountTitle.innerText = "Metadata Account"

    const metadataAccountAddress = document.getElementById("metadata_account_address")
    metadataAccountAddress.innerText = `Address: ${data.nft.metadataAddress}`

    const metadataUpdateAuthority = document.getElementById("metadata_account_update_authority")
    metadataUpdateAuthority.innerText = `Update Authority: ${data.nft.updateAuthorityAddress}`

    const metadataName = document.getElementById("metadata_account_name")
    metadataName.innerText = `Name: ${data.nft.name}`

    const metadataSymbol = document.getElementById("metadata_account_symbol")
    metadataSymbol.innerText = `Symbol: ${data.nft.symbol}`

    const metadataURI = document.getElementById("metadata_account_uri")
    metadataURI.innerText = `URI: ${data.nft.uri}`

    const metadataSellerFee = document.getElementById("metadata_account_seller_fee")
    metadataSellerFee.innerText = `Seller Fee Basis Points: ${data.nft.sellerFeeBasisPoints}`

    const metadataSellerCreators = document.getElementById("metadata_account_creators")
    document.getElementById("creators_title").innerText = "Creators: "
    const creators = [...document.getElementsByClassName("creator_address")]
    creators.forEach((creator) => {creator.remove()})
    data.nft.creators.forEach((creator) => {
        const pElem = document.createElement("p")
        pElem.innerText = `      ${creator.address} - Share: ${creator.share} - Verified: ${creator.verified} `
        pElem.classList.add("creator_address")
        metadataSellerCreators.appendChild(pElem)

    })

    const metadataPrimarySaleHappened = document.getElementById("metadata_account_primary_sale_happened")
    metadataPrimarySaleHappened.innerText = `Primary Sale Happened: ${data.nft.primarySaleHappened}`

    const metadataisMutable = document.getElementById("metadata_account_is_mutable")
    metadataisMutable.innerText = `Is Mutable: ${data.nft.isMutable}`

    const metadataCollection = document.getElementById("metadata_account_collection")
    metadataCollection.innerText = `Collection: ${data.collection} - Verified: ${data.collectionVerified}`

    // off-chain metadata 

    const offChainJSONContainer = document.getElementById("off_chain_json_pre_container")

    console.log(JSON.stringify(data.json))
    console.log(offChainJSONContainer)
    offChainJSONContainer.innerText = JSON.stringify(data.json, null, 2);

    // transactions

    data.txns.forEach((txn) => {
      const txn_tr = document.createElement("tr")
      const txn_td_signature = document.createElement("td")
      const aElement = document.createElement("a")
      aElement.href = `https://solscan.io/tx/${txn.signature}`
      aElement.innerText = `${txn.signature.slice(0,21)}...`
      aElement.setAttribute("target", "_blank")
      txn_td_signature.append(aElement)

      const txn_td_block = document.createElement("td")
      txn_td_block.innerText = `${txn.blockTime}`

      const txn_td_confirmation_status = document.createElement("td")
      txn_td_confirmation_status.innerText = `${txn.confirmationStatus}`

      txn_tr.append(txn_td_signature)
      txn_tr.append(txn_td_block)
      txn_tr.append(txn_td_confirmation_status)

      const txnsTable = document.getElementById("txns_table")

      txnsTable.append(txn_tr)

    })

    // ruleset account

    if(data.nft.programmableConfig != null && data.nft.programmableConfig != undefined) {
      const ruleSetAntTab = document.getElementById("ruleset_account_ant_tab")
      ruleSetAntTab.style.display = "block"
      const ruleSetAccountContainer = document.getElementById("ruleset_account_pre_container")
      ruleSetAccountContainer.innerText = JSON.stringify(data.ruleSetDecoded, null, 2);
    }


  }).catch(function(err) {

    console.warn('Something went wrong.', err);

    var element = document.getElementById("loading_wheel");
    element.className = "";

  })
}

</script>
</html>